# Maintainer: Alexey Pavlov <alexpux@gmail.com>

pkgname=ag
pkgver=0.30.0.31.gdf5d456
pkgrel=1
pkgdesc='A terminal multiplexer'
url='http://tmux.github.io/'
arch=('x86_64')
license=('Apache License 2.0')
provides=('ag')
conflicts=('ag')
depends=('libpcre' 'mingw-w64-x86_64-pcre' 'mingw-w64-x86_64-xz' 'lzip' 'xz')
makedepends=('git' 'pcre-devel' 'liblzma-devel')
source=("$pkgname"::'git+https://github.com/ggreer/the_silver_searcher.git'
        'msys-platform.patch')
md5sums=('SKIP'
         '1e92e2df2d8d0291c372c17aa178ed60')

pkgver() {
  cd "${srcdir}"/$pkgname
  git describe --tags | sed -e 's|-|.|g' -e 's|v||g'
}

prepare() {
  cd "${srcdir}"/$pkgname
  patch -p0 -i "${srcdir}"/msys-platform.patch
}

build() {
  cd "${srcdir}"/$pkgname
  make -f Makefile.w32
}

package() {
  cd "${srcdir}"/$pkgname
  cp ag.exe /usr/bin/ag.exe
  chmod 755 /usr/bin/ag.exe
}

