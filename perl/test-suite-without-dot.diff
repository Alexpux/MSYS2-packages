From b6b095db19c7249e5c8f6af658508ba229202ac0 Mon Sep 17 00:00:00 2001
From: Todd Rinaldo <toddr@cpan.org>
Date: Thu, 31 Mar 2016 17:04:29 -0500
Subject: Patch unit tests to explicitly insert "." into @INC when needed.

Backported to perl 5.22 by Dominic Hargreaves and forward
to 5.24 by Niko Tyni

Bug: https://rt.perl.org/Public/Bug/Display.html?id=127810
Patch-Name: debian/CVE-2016-1238/test-suite-without-dot.diff
---
 Makefile.SH                | 2 +-
 Porting/pod_rules.pl       | 2 +-
 TestInit.pm                | 2 +-
 lib/strict.t               | 2 +-
 lib/warnings.t             | 2 +-
 makedef.pl                 | 2 +-
 regen.pl                   | 2 +-
 regen/ebcdic.pl            | 3 +++
 regen/genpacksizetables.pl | 2 +-
 regen/mg_vtable.pl         | 2 +-
 t/comp/line_debug.t        | 2 ++
 t/lib/warnings/op          | 1 +
 t/op/goto.t                | 2 +-
 t/porting/regen.t          | 2 +-
 t/re/pat.t                 | 4 ++--
 t/run/switches.t           | 6 +++---
 t/test.pl                  | 3 ++-
 17 files changed, 24 insertions(+), 17 deletions(-)

diff --git a/TestInit.pm b/TestInit.pm
index f4ed6fd..f9a5e91 100644
--- a/TestInit.pm
+++ b/TestInit.pm
@@ -47,7 +47,7 @@ sub import {
 	} elsif ($_ eq 'T') {
 	    $chdir = '..'
 		unless -f 't/TEST' && -f 'MANIFEST' && -d 'lib' && -d 'ext';
-	    @INC = 'lib';
+	    @INC = qw/ lib . /;
 	    $setopt = 1;
 	} else {
 	    die "Unknown option '$_'";
diff --git a/t/run/switches.t.orig b/t/run/switches.t
index b61be56..b66afcd 100755
--- a/t/run/switches.t.orig
+++ b/t/run/switches.t
@@ -204,7 +204,7 @@ SWTESTPM
     );
     is( $r, "<$package><foo>", '-M with import parameter' );
     $r = runperl(
-	switches    => [ "-m$package" ],
+        switches    => [ "-I.", "-m$package" ],
 	prog	    => '1',
     );
 
